"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getBasePath = void 0;
const path_1 = require("path");
const util_1 = require("@sap-cloud-sdk/util");
const swagger_util_1 = require("./swagger-parser/swagger-util");
const logger = (0, util_1.createLogger)({
    package: 'generator',
    messageContext: 'options-per-service'
});
/**
 * @internal
 */
function getBasePath(metadata, skipValidation, optionsPerServiceIn) {
    let basePath = optionsPerServiceIn?.basePath ||
        basePathFromSelfLink(metadata.edmx.selfLink) ||
        (0, swagger_util_1.basePathFromSwagger)(metadata.swagger);
    if (!basePath) {
        if (skipValidation) {
            logger.warn(`[ ${(0, path_1.parse)(metadata.edmx.path.toString()).name} ] No base path could be determined from available metadata! Setting "basePath" to "/" as default value. Consider using 'optionsPerService' configuration to explicitly set a value.`);
            basePath = '/';
        }
        else {
            throw new Error(`[ ${(0, path_1.parse)(metadata.edmx.path.toString()).name} ] No base path could be determined from available metadata! Enable '--skipValidation' to use "/" as a default value. Alternatively use the 'optionsPerService' configuration to explicitly set a value.`);
        }
    }
    return basePath;
}
exports.getBasePath = getBasePath;
function basePathFromSelfLink(selfLink) {
    if (selfLink) {
        return selfLink
            .replace(/^https?:\/\//, '')
            .replace(/\/\$metadata$/, '')
            .replace(/^[^/]+/, '');
    }
}
//# sourceMappingURL=service-base-path.js.map